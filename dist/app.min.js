/*! FB_PAGE_FAV Assignment by LS. 2017-04-15 */
"use strict";!function(a){var b=function(){this.topics={},this.subUid=-1};b.prototype.listenTo=function(a,b){this.topics[a]||(this.topics[a]=[]);var c=(++this.subUid).toString();return this.topics[a].push({token:c,func:b}),c},b.prototype.on=function(a,b,c){if(!b.topics||!b.topics[a])return!1;for(var d=b.topics[a],e=d?d.length:0;e--;)d[e].func(b,c);return!0},b.prototype.dontListen=function(a){for(var b in this.topics)if(this.topics[b])for(var c=0,d=this.topics[b].length;d>c;c++)if(this.topics[b][c].token===a)return this.topics[b].splice(c,1),a;return!1},a.listenerEvents=b}(app),function(a){a.isFunction=function(a){return"function"==typeof a},a.extendClass=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a},a.isEmptyObject=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return JSON.stringify(a)===JSON.stringify({})}}(app),function(a){var b=function(b){b=b||{},this.data=b.data||{},this.localStorageKey=b.localStorageKey||void 0,this.dataArrayField=b.dataArrayField,a.listenerEvents.call(this),a.isFunction(b.init)&&b.init.call(this,b),this.localStorageKey&&this.restoreData()};a.extendClass(b,a.listenerEvents),b.prototype.getData=function(){return $.extend(!0,{},this.data)},b.prototype.setData=function(a,b,c,d){this.data[a]=b,c&&this.storeData(),d||this.on("model:set",this)},b.prototype.resetData=function(a,b){this.data=a,b||this.on("model:reset",this)},b.prototype.addItem=function(a,b,c,d){void 0==typeof this.data[a]&&(this.data[a]=[]),this.data[a].push(b),c&&this.storeData(),d||this.on("model:update",this)},b.prototype.append=function(a,b,c,d){void 0==typeof this.data[a]&&(this.data[a]=[]),this.data[a]=this.data[a].concat(b),c&&this.storeData(),d||this.on("model:update",this)},b.prototype.storeData=function(){this.getData()&&this.localStorageKey&&localStorage.setItem(this.localStorageKey,JSON.stringify(this.getData()))},b.prototype.restoreData=function(){var a;this.localStorageKey&&(a=localStorage.getItem(this.localStorageKey)),a?this.resetData(JSON.parse(a)):this.clearStorage()},b.prototype.clearStorage=function(){return localStorage.removeItem(this.localStorageKey)};var c=function(a){b.call(this,a),this.FBCredentials=a.data.FBCredentials};a.extendClass(c,b),c.prototype.connect=function(a){try{FB.init(this.FBCredentials),this.login(a)}catch(b){console.log(b)}},c.prototype.login=function(b){a.isFunction(b)&&FB.getLoginStatus(function(a){"connected"==a.status?b.call(this,a):FB.login(function(a){"connected"==a.status&&b.call(this,a)},{scope:"user_friends, email"})})},c.prototype.query=function(a,b,c,d,e,f){this.setData(this.dataArrayField,[],!0),this.queryCall(a,b,c,d,e,!0,f)},c.prototype.queryCall=function(b,c,d,e,f,g,h){var i=this;e||(e=10),FB.api("/search","GET",{q:b,type:c,fields:d,limit:e,after:g},function(j){j.error?console.log(j.error):(i.append(i.dataArrayField,j.data,!0),a.isFunction(h)&&h.call(this,j),f&&(f-=1,g&&f>0&&j&&j.paging&&j.paging.cursors&&i.queryCall(b,c,d,e,f,j.paging.cursors.after)))})},c.prototype.plainQuery=function(){},c.prototype.find=function(a){var b=_.findWhere(this.data[this.dataArrayField],{id:a+""});return $.extend(!0,{},b)};var d=function(a){b.call(this,a)};a.extendClass(d,b),d.prototype.setData=void 0,d.prototype.find=function(a){if(void 0!==typeof this.data[this.dataArrayField])var b=_.findWhere(this.data[this.dataArrayField],{id:a+""});return b},d.prototype.indexOf=function(a){if(void 0!==typeof this.data[this.dataArrayField])var b=_.findIndex(this.data[this.dataArrayField],{id:a});return b},d.prototype.isFav=function(a){return this.indexOf(a)>=0?!0:!1},d.prototype.toggleItem=function(a,b,c){this.indexOf(a.id)>=0?this.removeItem(a):this.addItem(a,b,c)},d.prototype.addItem=function(a,b,c){var d=this.dataArrayField;"undefined"==typeof this.data[d]&&(this.data[d]=[]),this.data[d].push(a),b&&this.storeData(),c||this.on("model:update",this)},d.prototype.removeItem=function(a,b,c){var d=this.dataArrayField,e=this.indexOf(a.id);this.data[d].splice(e,1),b&&this.storeData(),c||this.on("model:remove",this,a)},a.Model=b,a.FBModel=c,a.FavouriteModel=d}(app),function(a){var b=function(b){b&&(a.listenerEvents.call(this),this.template=b.template||"",this.compiledTemplate=_.template(this.template.html()),this.region=b.region||"body",this.model=b.model||new a.Model,this.afterRender=b.afterRender,this.templateContext=b.templateContext,this.beforeRerender=b.beforeRerender,this.renderCount=0,this.$el=$("<div></div>"),$(this.region).append(this.$el),a.isFunction(b.init)&&b.init.call(this))};b.prototype=Object.create(a.listenerEvents.prototype),b.prototype.constructor=b,_.extend(b.prototype,b.prototype.__proto__),b.prototype.render=function(b){this.renderCount++,a.isFunction(this.beforeRerender)&&this.renderCount>1&&this.beforeRerender();var c=this.compiledTemplate($.extend(!0,{},this.model.getData(),this.templateContext));switch(this.beforeRender&&this.afterRender.call(this),b){case"append":this.$el.append(c);break;case"prepend":this.$el.prepend(c);break;case"replace":default:this.$el.html(c)}this.afterRender&&this.afterRender.call(this)},a.View=b}(app),function(a){var b=function(b){this.options=b,this.model=b.model||new a.Model,this.viewModelMapping={},this.primaryField=b.primaryField||"id",this.options.emptyTemplate&&(this.compiledEmptyView=_.template(this.options.emptyTemplate.html()));var c=this;this.model.listenTo("model:update",function(a,b){c.renderNewOnly()}),this.model.listenTo("model:reset",function(){c.render()}),this.model.listenTo("model:set",function(){c.render()}),this.model.listenTo("model:remove",function(a,b){c.removeOld(b.id)})};b.prototype.render=function(){var b=this;this.empty(),this.showEmptyView(),_.each(this.model.getData()[this.model.dataArrayField],function(c){var d={model:new a.Model({data:c})},e=new a.View($.extend(!0,{},b.options,d));b.viewModelMapping[c[b.primaryField]]=e,e.render("append")})},b.prototype.renderNewOnly=function(){a.isEmptyObject(this.viewModelMapping)&&this.empty();var b=this;_.each(this.model.getData()[this.model.dataArrayField],function(c){if("object"!=typeof b.viewModelMapping[c[b.primaryField]]){var d={model:new a.Model({data:c})},e=new a.View($.extend(!0,{},b.options,d));b.viewModelMapping[c[b.primaryField]]=e,e.render("append")}})},b.prototype.removeOld=function(a){var b=this;b.viewModelMapping[a].$el.remove(),delete b.viewModelMapping[a],this.showEmptyView()},b.prototype.showEmptyView=function(){0==this.model.getData()[this.model.dataArrayField].length&&this.compiledEmptyView&&$(this.options.region).html(this.compiledEmptyView())},b.prototype.empty=function(){$(this.options.region).empty(),0==this.model.getData()[this.model.dataArrayField].length&&(this.viewModelMapping={})},a.CollectionView=b}(app),function(a,b){var c=new a.Model({localStorageKey:"search_data"}),d=new a.View({template:b("#searchTemplate"),region:"#searchTemplateContainer",model:c,afterRender:function(){var a=this;this.$el.on("change","input#search",function(c){var d=b(c.currentTarget).val();a.model.setData("search",d,!0),g.query(d,"page","name, id, about, category, picture, fan_count, link",20,5)})},beforeRerender:function(){this.$el.off("change","input")}});d.render();var e=new a.View({template:b("#headerTemplate"),region:"#headerWrapper",afterRender:function(){this.$el.on("click","ul li.tab",function(a){var c=b(a.target).closest("li").attr("id");switch(c){case"searchTab":i.render();break;case"favTab":j.render()}})}});e.render();var f=new a.View({template:b("#footerTemplate"),region:"#footer-copyright"});f.render();var g=new a.FBModel({localStorageKey:"fb_data",dataArrayField:"queryData",data:{FBCredentials:{appId:"802617683083235",xfbml:!0,version:"v2.8"}},init:function(a){}});window.fbAsyncInit=function(){g.connect(function(){})};var h=new a.FavouriteModel({localStorageKey:"favt_data",dataArrayField:"queryData",init:function(){}}),i=new a.CollectionView({template:b("#cardTemplate"),emptyTemplate:b("#noDataAvailable"),region:"#searchResult",model:g,templateContext:{colClass:"l2 m3 s12",getImagePath:function(a){return"https://graph.facebook.com/"+a+"/picture?type=normal"},isFav:function(a){return h.isFav(a)},showFav:function(){return!0}},afterRender:function(){var a=this;this.$el.on("click",".favBtn",function(c){b(c.currentTarget).closest(".card").data("pageid");b(c.currentTarget).toggleClass("white"),h.toggleItem(a.model.getData(),!0,!0)})},beforeRerender:function(){this.$el.off("click",".favBtn")}});i.render();var j=new a.CollectionView({template:b("#cardTemplate"),emptyTemplate:b("#noDataAvailable"),region:"#favResult",model:h,templateContext:{colClass:"l2 m3 s12",getImagePath:function(a){return"https://graph.facebook.com/"+a+"/picture?type=normal"},showFav:function(){return!1},isFav:function(a){return h.isFav(a)}},init:function(){this.listenTo("view:render",function(a){console.log("View Rendered.")})},afterRender:function(){var a=this;this.$el.on("click",".cancelBtn",function(b){h.removeItem(a.model.getData(),!0)})},beforeRerender:function(){this.$el.off("click",".cancelBtn")}})}(app,jQuery);